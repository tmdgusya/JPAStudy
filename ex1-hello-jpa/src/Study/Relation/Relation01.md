# 다양한 연관관계

엔티티를 Mapping 할 때는 다음 3가지를 고려해야 한다.

- **다중성**
- **단방향 , 양방향**
- **연관관계의 주인**

먼저 연관관계가 있는 두 엔티티가 일대일 관계인지, 일대다 관계인지 다중성을 고려해야 한다. 다음으로 두 엔티티 중 한쪽만 참조하는 단방향 관계인지 서로 참조하는 양방향 관계인지도 고려해야 한다.
마지막으로 양방향 관계면 연관관계의 주인을 정해야 한다.

- 연관관계에는 다음과 같은 다중성이 있다.
    - 다대일(@ManyToOne)
    - 일대다(@OneToMany)
    - 일대일(@OneToOne)
    - 다대다(@ManyToMany) => 실무에서는 사용할 일이 거의 없다고 보면됨!

- 테이블은 항상 양방향이므로, 사실 방향이란 개념이 잘없다. 하지만 객체는 참조용 필드를 가지고 있는 객체만 연관된 객체를 조회할 수 있다.
그래서 객체 관계에서 한쪽만 참조하는 것을 단방향 관계라 하고, 양쪽이 서로 참조하는 것을 양방향 관계라고 한다.

- 데이터 베이스는 외래키 하나로 두 테이블이 연관관계를 맺는다. 따라서 테이블의 연관관계를 관리하는 포인트는 외래 키 하나다.
- 하지만 객체는 서로 참조해야 하므로, 연관관계를 관리하는 포인트는 총 2곳이다. 그래서 2곳 중 한곳에서 외래키를 관리하게 해야하는데, 그 곳이
바로 주인이라 한다.

# 다대일 관계 [N:1]

## 다대일 단방향 관계 [N:1]
- Many 부분에서 단방향으로 One 부분을 참조할 수 있으나, One 부분에서는 다 부분을 참조하지 못함 
- 한쪽 방향에서만 참조할 수 있는 관계 / 이 관계는 어디에서 사용되는지 잘모르겠다. DB 자체가 양방향이다 보니 좀 알아보자!!

## 다대일 양방향 관계 [1:N, N:1]
- 해당 관계는 주인을 설정해 줘야 하기때문에, People 의 team 이 주인이고, team.peoples 가 종속적인 관계이다.
- 항상 중요한 이야기는 양방향은 외래키가 있는 곳이 항상 주인이다.
- 양방향 연관관계는 항상 서로를 참조해야 한다. 

# 일대다 관계 [1:N]
- 일대다 관계는 다대일 관계의 반대 방향이다. 일대 다 관계는 엔티티를 하나 이상 참조할 수 있으므로, 자바 Collections 을 사용해야 한다.
- 외래키를 해당 테이블에서 대신 관리하는데, 정말 직관 적이지도 않고, 구져보인다. 솔직히말해서 절대로 안쓸것 같음 너무 구짐!
- 외래키가 그리고 여기있으면, INSERT 후에 UPDATE QUERY 를 한번더 쏴야한다. 즉 N+1 문제 발생
- 아 시원! 김영한 님도 결국 일대다 단방향 보다는 다대일 양방향 매핑을 사용하라고 한다! 나도 그게 맞는것 같다. 외래키 관리 측면이나 쿼리측면 그리고 직관성까지 후지다!.

## 일대다 단방향[1:N]
- Section 3 참고 그리고 위에 설명을 다했음!

## 일대다 양방향
- 일대다 양방향이란 존재하지 않는다. 대신 다대일 양방향을 지양해야한다. 사실 둘다 똑같은 말이다. 구분할수 없다 ㅋㅋ
다만 주인 부분이 항상 Many 쪽이기 때문에 그냥 다대일 양방향이라고 하자!

# 일대일 관계 [1:1]

- 일대일 관계는 양쪽이 서로 하나의 관계만을 가진다.
- 일대일 관계를 예를들면 사물함 <-> 회원관계로 들면된다. 회원이 하나의 사물함에 Mapping 되므로(물론 돌려쓰는 상황 제외!) 이와 같은 관계를 생각하면 된다!!
- 테이블은 주테이블이던, 대상 테이블이던 외래 키 하나만 있으면, 양쪽으로 조회할 수 있다.
- 외래키 관리방법
    - > 주테이블에 외래키
        -  주 객체가 대상 객체를 참조하는 것 처럼 주 테이블에 외래키를 두고 대상 테이블을 참고한다.
        -  외래 키를 객체 참조와 비슷하게 사용할 수 있어서 개발자들이 선호한다.
        -  이 방법의 장점은 주테이블이 외래키를 가지고 있으므로, 주 테이블만 확인해도 대상테이블과 연관관계가 있는지 알수있다.
    - > 대상 테이블의 외래키
        -  전통적인 데이터베이스 개발자들이 추구하는 방식
        -  장점은 테이블 관계를 일대일 에서 일대다로 변경할때도 이 구조를 그대로 유지할 수 있다.
        
- 일대일 관계는 단방향 관계가 없다. 무조건 양방향 관계로 설계되어야 한다.

# 다대다 [N:N]
- 관계형 데이터 베이스는 정규화된 테이블 2개로 다대다 관계를 포함할 수 없다. 그래서 보통 다대다 관계를 일대다, 다대일 관계로 풀어내는 연결 테이블을 사용한다.
- 만약 회원 테이블과 상품테이블이 있다고 해보자. 회원은 상품을 여러개 주문할 수 있고, 상품도 여러 회원에 의해 주문될 수 있다.
따라서 N : N 관계가 된다. 근데 이 관계는 데이터베이스에서 표현될 수 없다고 한다. 그래서 중간에 연결 테이블을 생성해야 한다.
- **Member 1 ---- N Member_product N ------ 1 Product**  식으로 중간에 Member_product 연결 테이블을 추가해줬다.

## 다대다 단방향 

- 다대다 단방향의 경우 쿼리를 실제로 날려보면 연결 테이블에도 값이 저장된다.
- 연결테이블을 SELECT * FROM 해보면 FK 로 구성되어 있는 것 같다. 연결 테이블이 Key 를 Mapping 하여 참조할 수 있게 해주는 역할을 하는것 같다.


